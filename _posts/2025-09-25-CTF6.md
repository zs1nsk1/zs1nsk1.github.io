---
title: System-Host Based Attacks - CTF 2
date: 2025-09-27 12:10:12 +/-TTTT
categories: [INE, Ejptv2]
tags: [Nmap, Shellshock, Metasploit, Libssh, SUID]     # TAG names should always be lowercase


description: Privilege Escalation and Persistence in Host-Based Attacks.

#toc: false
---

![img-description](/assets/img/Posts/ine.png)



## CTF Solved: From Shellshock to Root - Host-Based Attacks 2 (eJPT INE)
The second challenge in INE's Host-Based Attacks series shifts focus to exploiting critical vulnerabilities in Linux environments. This lab showcased a full attack lifecycle: gaining an initial shell via Remote Code Execution (RCE) and then escalating to root by abusing local binary execution rules.

---
### 1. Target 1: Initial Compromise via RCE (target1.ine.local)
The first stage involved gaining initial access by exploiting a known, severe network service vulnerability.

Key Vector: The Shellshock Vulnerability (`CVE-2014-6271`)

Reconnaissance: Initial Nmap scanning revealed port 80 open, identifying an Apache 2.4.6 server. Browsing to the site redirected to a `.cgi` script (`/browser.cgi`).

Vulnerability Identification: The combination of Apache and `.cgi` scripts is a strong indicator to test for Shellshock, a critical RCE flaw in the Bash shell.

Exploitation with Metasploit (`Flag 1 & 2`):

We confirmed the vulnerability using the Metasploit module `scanner/http/apache_mod_cgi_bash_env`.

The attack was executed using `exploit/multi/http/apache_mod_cgi_bash_env_exec`, correctly setting `RHOSTS`, `TARGETURI`, and our listening IP (`LHOST`).

Result: A Meterpreter shell was obtained as a low-privileged user (e.g., `www-data`). Flag 1 was immediately found in the root directory (`/`), and Flag 2 was retrieved from a hidden file (`.flag2.txt`) in the web server's document root (`/opt/apache/htdocs/`), revealed via `ls -la`.

---
### 2. Target 2: Local Privilege Escalation (target2.ine.local)
The second host presented a different challenge, requiring an initial SSH compromise followed by a local system attack to achieve root.

Initial Access: LibSSH Authentication Bypass (`Flag 3`)
Reconnaissance: Nmap showed port 22 open, running libssh version 0.8.3.

Vulnerability Identification: This specific `libssh` version is susceptible to an authentication bypass (`CVE-2018-10933`), which allows an attacker to skip the authentication process by sending a single, specific message.

Exploitation: We utilized the Metasploit module `exploit/linux/ssh/libssh_auth_bypass` to gain a shell without needing any credentials.

Result: A shell was granted as a regular user. Flag 3 was found within the user's home directory (`/home/user/`).

---
### 3. Escalation to Root via Binary Abuse (Flag 4)
The final step involved a classic file manipulation technique to escalate privileges from the regular user to root.

Vulnerability: The user's home directory contained two binaries: `greetings` and `welcome`. The welcome binary was executable and, critically, called the greetings binary without specifying its absolute path (verified using the strings welcome command).

- The Attack: Binary Hijacking:

The `welcome` binary was likely running with elevated permissions (e.g., `SUID or root context`).

We created a malicious file named `greetings` in the same directory. This script contained a payload to copy the Bash shell and set the SUID bit: `cp /bin/bash greetings`.

When the welcome binary was executed (`./welcome`), it called our fake `greetings` file, which ran the payload with elevated permissions.

Result: By executing the newly modified binary, we successfully escalated to root. `Flag 4` was found in the system's most restricted directory: `/root/`.

---
### Key Takeaways for System Security
This CTF reinforces two non-negotiable fundamentals of system security:

Patch Management: The Shellshock and LibSSH flaws demonstrate that keeping network services unpatched is a direct path to system compromise via RCE or authentication bypass.

Binary Hardening: System scripts or SUID binaries must never call internal commands without using their absolute path (e.g., /bin/cat instead of just cat). This prevents a low-privileged user from "hijacking" the command execution path and escalating privileges.